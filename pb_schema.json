{
  "collections": [
    {
      "id": "system_config",
      "type": "base",
      "name": "System Config",
      "schema": [
        { "name": "resendDomain", "type": "text", "required": false },
        { "name": "rateLimits", "type": "json", "required": false },
        { "name": "oauthCredentials", "type": "json", "required": false },
        { "name": "globalFeatures", "type": "json", "required": false }
      ],
      "indexes": []
    },
    {
      "id": "tenants",
      "type": "base",
      "name": "Tenants",
      "schema": [
        { "name": "slug", "type": "text", "required": true },
        { "name": "name", "type": "text", "required": true },
        { "name": "displayName", "type": "text", "required": false },
        { "name": "description", "type": "text", "required": false },
        { "name": "logoUrl", "type": "url", "required": false },
        { "name": "primaryColor", "type": "text", "required": false },
        { "name": "status", "type": "select", "required": true, "options": { "values": ["pending", "active", "suspended", "deactivated", "pending_deletion"] } },
        { "name": "tier", "type": "select", "required": true, "options": { "values": ["free", "starter", "professional", "enterprise"] } },
        { "name": "pulsepointAgencyId", "type": "text", "required": false },
        { "name": "pulsepointConfig", "type": "json", "required": false },
        { "name": "weatherZones", "type": "json", "required": false },
        { "name": "features", "type": "json", "required": false },
        { "name": "limits", "type": "json", "required": false },
        { "name": "trialEndsAt", "type": "datetime", "required": false },
        { "name": "deactivatedAt", "type": "datetime", "required": false },
        { "name": "deactivatedReason", "type": "text", "required": false },
        { "name": "deletionScheduledAt", "type": "datetime", "required": false },
        { "name": "billingCustomerId", "type": "text", "required": false },
        { "name": "billingSubscriptionId", "type": "text", "required": false }
      ],
      "indexes": [
        { "unique": true, "fields": ["slug"] },
        { "fields": ["status"] },
        { "fields": ["tier"] },
        { "fields": ["deactivatedAt"] }
      ]
    },
    {
      "id": "users",
      "type": "auth",
      "name": "Users",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": false, "collectionId": "tenants" },
        { "name": "name", "type": "text", "required": false },
        { "name": "username", "type": "text", "required": false },
        { "name": "avatar", "type": "file", "required": false },
        { "name": "bio", "type": "text", "required": false },
        { "name": "role", "type": "select", "required": true, "options": { "values": ["user", "platform_admin"] } },
        { "name": "tenantRole", "type": "select", "required": false, "options": { "values": ["member", "moderator", "admin", "owner"] } },
        { "name": "isActive", "type": "bool", "required": false },
        { "name": "isBanned", "type": "bool", "required": false },
        { "name": "bannedAt", "type": "datetime", "required": false },
        { "name": "bannedReason", "type": "text", "required": false },
        { "name": "preferences", "type": "json", "required": false },
        { "name": "lastLoginAt", "type": "datetime", "required": false }
      ],
      "indexes": [
        { "fields": ["tenantId"] },
        { "fields": ["role"] },
        { "fields": ["tenantId", "tenantRole"] }
      ]
    },
    {
      "id": "accounts",
      "type": "base",
      "name": "Accounts",
      "schema": [
        { "name": "userId", "type": "relation", "required": true, "collectionId": "users" },
        { "name": "type", "type": "text", "required": true },
        { "name": "provider", "type": "text", "required": true },
        { "name": "providerAccountId", "type": "text", "required": true },
        { "name": "accessToken", "type": "text", "required": false },
        { "name": "refreshToken", "type": "text", "required": false },
        { "name": "expiresAt", "type": "datetime", "required": false },
        { "name": "tokenType", "type": "text", "required": false },
        { "name": "scope", "type": "text", "required": false },
        { "name": "idToken", "type": "text", "required": false },
        { "name": "sessionState", "type": "text", "required": false }
      ],
      "indexes": [
        { "unique": true, "fields": ["provider", "providerAccountId"] },
        { "fields": ["userId"] }
      ]
    },
    {
      "id": "sessions",
      "type": "base",
      "name": "Sessions",
      "schema": [
        { "name": "sessionToken", "type": "text", "required": true },
        { "name": "userId", "type": "relation", "required": true, "collectionId": "users" },
        { "name": "expires", "type": "datetime", "required": true }
      ],
      "indexes": [
        { "unique": true, "fields": ["sessionToken"] },
        { "fields": ["userId"] },
        { "fields": ["expires"] }
      ]
    },
    {
      "id": "social_accounts",
      "type": "base",
      "name": "Social Accounts",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": true, "collectionId": "tenants" },
        { "name": "provider", "type": "select", "required": true, "options": { "values": ["facebook", "twitter", "instagram", "discord"] } },
        { "name": "providerUserId", "type": "text", "required": true },
        { "name": "providerUsername", "type": "text", "required": false },
        { "name": "accessToken", "type": "text", "required": true },
        { "name": "refreshToken", "type": "text", "required": false },
        { "name": "expiresAt", "type": "datetime", "required": false },
        { "name": "scope", "type": "text", "required": false },
        { "name": "isActive", "type": "bool", "required": false },
        { "name": "lastUsedAt", "type": "datetime", "required": false },
        { "name": "errorCount", "type": "number", "required": false },
        { "name": "lastError", "type": "text", "required": false }
      ],
      "indexes": [
        { "unique": true, "fields": ["tenantId", "provider", "providerUserId"] },
        { "fields": ["tenantId"] },
        { "fields": ["provider"] }
      ]
    },
    {
      "id": "audit_logs",
      "type": "base",
      "name": "Audit Logs",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": false, "collectionId": "tenants" },
        { "name": "actorId", "type": "text", "required": true },
        { "name": "actorType", "type": "select", "required": false, "options": { "values": ["user", "system", "api"] } },
        { "name": "action", "type": "text", "required": true },
        { "name": "targetType", "type": "text", "required": false },
        { "name": "targetId", "type": "text", "required": false },
        { "name": "details", "type": "json", "required": false },
        { "name": "ipAddress", "type": "text", "required": false },
        { "name": "userAgent", "type": "text", "required": false },
        { "name": "result", "type": "select", "required": false, "options": { "values": ["success", "failure"] } }
      ],
      "indexes": [
        { "fields": ["tenantId"] },
        { "fields": ["actorId"] },
        { "fields": ["action"] },
        { "fields": ["created"] }
      ]
    },
    {
      "id": "rate_counters",
      "type": "base",
      "name": "Rate Counters",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": true, "collectionId": "tenants" },
        { "name": "resource", "type": "text", "required": true },
        { "name": "tokens", "type": "number", "required": true },
        { "name": "lastRefill", "type": "datetime", "required": true }
      ],
      "indexes": [
        { "unique": true, "fields": ["tenantId", "resource"] },
        { "fields": ["lastRefill"] }
      ]
    },
    {
      "id": "incidents",
      "type": "base",
      "name": "Incidents",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": true, "collectionId": "tenants" },
        { "name": "source", "type": "select", "required": true, "options": { "values": ["pulsepoint", "user_submitted", "merged", "manual"] } },
        { "name": "externalId", "type": "text", "required": false },
        { "name": "callType", "type": "text", "required": true },
        { "name": "callTypeCategory", "type": "select", "required": false, "options": { "values": ["fire", "medical", "rescue", "traffic", "hazmat", "other"] } },
        { "name": "fullAddress", "type": "text", "required": true },
        { "name": "normalizedAddress", "type": "text", "required": false },
        { "name": "latitude", "type": "number", "required": false },
        { "name": "longitude", "type": "number", "required": false },
        { "name": "units", "type": "json", "required": false },
        { "name": "unitStatuses", "type": "json", "required": false },
        { "name": "description", "type": "text", "required": false },
        { "name": "status", "type": "select", "required": true, "options": { "values": ["active", "closed", "archived"] } },
        { "name": "callReceivedTime", "type": "datetime", "required": true },
        { "name": "callClosedTime", "type": "datetime", "required": false },
        { "name": "submittedBy", "type": "relation", "required": false, "collectionId": "users" },
        { "name": "moderationStatus", "type": "select", "required": false, "options": { "values": ["auto_approved", "pending", "approved", "rejected"] } },
        { "name": "moderatedBy", "type": "relation", "required": false, "collectionId": "users" },
        { "name": "moderatedAt", "type": "datetime", "required": false },
        { "name": "rejectionReason", "type": "text", "required": false },
        { "name": "isSyncedToFacebook", "type": "bool", "required": false },
        { "name": "facebookPostId", "type": "text", "required": false },
        { "name": "needsFacebookUpdate", "type": "bool", "required": false },
        { "name": "lastSyncAttempt", "type": "datetime", "required": false },
        { "name": "syncError", "type": "text", "required": false }
      ],
      "indexes": [
        { "fields": ["tenantId"] },
        { "fields": ["tenantId", "status"] },
        { "fields": ["tenantId", "callReceivedTime"] },
        { "fields": ["tenantId", "source"] },
        { "unique": true, "fields": ["tenantId", "externalId"] }
      ]
    },
    {
      "id": "incident_updates",
      "type": "base",
      "name": "Incident Updates",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": true, "collectionId": "tenants" },
        { "name": "incidentId", "type": "relation", "required": true, "collectionId": "incidents" },
        { "name": "submittedBy", "type": "relation", "required": true, "collectionId": "users" },
        { "name": "updateText", "type": "text", "required": true },
        { "name": "status", "type": "select", "required": true, "options": { "values": ["pending", "approved", "rejected"] } },
        { "name": "moderatedBy", "type": "relation", "required": false, "collectionId": "users" },
        { "name": "moderatedAt", "type": "datetime", "required": false },
        { "name": "rejectionReason", "type": "text", "required": false },
        { "name": "isSyncedToFacebook", "type": "bool", "required": false }
      ],
      "indexes": [
        { "fields": ["tenantId"] },
        { "fields": ["incidentId"] },
        { "fields": ["tenantId", "status"] }
      ]
    },
    {
      "id": "weather_alerts",
      "type": "base",
      "name": "Weather Alerts",
      "schema": [
        { "name": "tenantId", "type": "relation", "required": true, "collectionId": "tenants" },
        { "name": "nwsId", "type": "text", "required": true },
        { "name": "event", "type": "text", "required": true },
        { "name": "headline", "type": "text", "required": true },
        { "name": "description", "type": "text", "required": false },
        { "name": "instruction", "type": "text", "required": false },
        { "name": "severity", "type": "select", "required": true, "options": { "values": ["Extreme", "Severe", "Moderate", "Minor", "Unknown"] } },
        { "name": "urgency", "type": "select", "required": false, "options": { "values": ["Immediate", "Expected", "Future", "Unknown"] } },
        { "name": "certainty", "type": "select", "required": false, "options": { "values": ["Observed", "Likely", "Possible", "Unlikely", "Unknown"] } },
        { "name": "category", "type": "text", "required": false },
        { "name": "onset", "type": "datetime", "required": false },
        { "name": "expires", "type": "datetime", "required": true },
        { "name": "ends", "type": "datetime", "required": false },
        { "name": "affectedZones", "type": "json", "required": false },
        { "name": "status", "type": "select", "required": true, "options": { "values": ["active", "expired", "cancelled"] } },
        { "name": "isSyncedToFacebook", "type": "bool", "required": false },
        { "name": "facebookPostId", "type": "text", "required": false },
        { "name": "lastFacebookPostTime", "type": "datetime", "required": false }
      ],
      "indexes": [
        { "fields": ["tenantId"] },
        { "fields": ["tenantId", "status"] },
        { "unique": true, "fields": ["tenantId", "nwsId"] },
        { "fields": ["expires"] }
      ]
    }
  ]
}
